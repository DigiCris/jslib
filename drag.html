<!DOCTYPE html>
<html>
<head>
  <title>Elemento Arrastrable</title>
  <style>
    /*
    .draggable {
      position: absolute;
      cursor: move;
      z-index: 9;
    }
      */
      #pantalla {
        width: 300px;
        height: 300px;
        border: 2px solid black;
        position: absolute;
        top: 300px;
        left: 300px;
      }
  </style>
</head>
<body id="body">
    <div id="pantalla">

    </div>
  <div id="my-element">
    Hola.
  </div>

  <div id="my-element2">
    Chau.
  </div>

  <script>
function makeDraggable(elementId) {
    // Obtener el elemento a convertir en arrastrable
    const element = document.getElementById(elementId);
    element.style.cursor = 'move';
    element.style.position = "absolute"
    //element.classList.add('draggable');

    // Variables para almacenar la posición del mouse
    let currentX;
    let currentY;
    let initialX;
    let initialY;
    let xOffset = 0;
    let yOffset = 0;
    let active = false;

    let zIndex = 0;

    element.addEventListener('mousedown', dragStart);
    element.addEventListener('mouseup', dragEnd);
    element.addEventListener('mousemove', drag);

    function dragStart(e) {
        zIndex = this.style.zIndex ;
        this.style.zIndex = Number(zIndex) + 100000;
        initialX = e.clientX - xOffset;
        initialY = e.clientY - yOffset;

        if (e.target === element) {
            active = true;
        }
    }

    function dragEnd(e) {
        console.log( trackMousePosition(this.id) )
        idtop = trackMousePosition(this.id);
        if(idtop!="") {
            this.style.zIndex = Number( document.querySelector("#"+idtop).style.zIndex ) +1;
        }else {
            this.style.zIndex = zIndex;
        }
        //console.log("termina")
        initialX = currentX;
        initialY = currentY;

        active = false;
    }

    function drag(e) {
        if (active) {
            e.preventDefault();

            if (e.target === element) {
                currentX = e.clientX - initialX;
                currentY = e.clientY - initialY;

                xOffset = currentX;
                yOffset = currentY;

                setTranslate(currentX, currentY, element);
            }
        }
    }

    function setTranslate(xPos, yPos, el) {
        el.style.transform = `translate3d(${xPos}px, ${yPos}px, 0)`;
    }

    function trackMousePosition(id) {
        const elementsUnderMouse = document.elementsFromPoint(event.clientX, event.clientY);
        for (const element of elementsUnderMouse) {
            if(id != element.id) {
                const sortedElements = elementsUnderMouse.sort((a, b) => b.style.zIndex - a.style.zIndex);
                const elementIds = sortedElements.map(el => el.id);
                const elementIndex = elementsUnderMouse.indexOf(element);
                return(elementIds[elementIndex])
                console.log(elementIds[elementIndex]);
            }
        }
    }


}



/**
 * Uso:
createSpinner('https://algo.gif', 50, 50, 'mySpinnerId');
openSpinner('mySpinnerId',10);
closeSpinner('mySpinnerId');

 * Crea un spinner y lo agrega al DOM con la configuración proporcionada
 * @param {string} spinnerImage - La URL de la imagen del spinner
 * @param {number} width - El ancho del spinner
 * @param {number} height - El alto del spinner
 * @param {string} spinnerId - El ID del spinner
 */
 function createSpinner(spinnerImage, width, height, spinnerId) {
  // Crear el elemento del spinner
  const spinner = document.createElement('div');
  spinner.id = spinnerId;
  spinner.classList.add('spinner');

  // Establecer el estilo del spinner
  spinner.style.position = 'fixed';
  spinner.style.width = `${width}px`;
  spinner.style.height = `${height}px`;
  spinner.style.zIndex = '9999';
  spinner.style.backgroundImage = `url(${spinnerImage})`;
  spinner.style.backgroundSize = 'contain';
  spinner.style.backgroundRepeat = 'no-repeat';
  spinner.style.backgroundPosition = 'center';
  spinner.style.top = '50%';
  spinner.style.left = '50%';
  spinner.style.transform = 'translate(-50%, -50%)';
  spinner.style.display = 'none'; // Inicialmente oculto

  // Agregar la animación de rotación
  spinner.style.animation = 'spin 1s linear infinite';
  const spinAnimation = document.createElement('style');
  spinAnimation.textContent = `
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  `;
  document.head.appendChild(spinAnimation);

  // Agregar el spinner al documento
  document.body.appendChild(spinner);
}

/**
 * Abre un spinner existente
 * @param {string} spinnerId - El ID del spinner a abrir
 * @param {number} spinSpeed - Velocidad del spinner
 */
function openSpinner(spinnerId, spinSpeed) {
    // Obtener el spinner por su ID
    const spinner = document.getElementById(spinnerId);

    if (spinner) {
        // Crear el fondo de pantalla oscuro y borroso
        const overlay = document.createElement('div');
        overlay.classList.add('spinner-overlay');
        overlay.style.position = 'fixed';
        overlay.style.top = '0';
        overlay.style.left = '0';
        overlay.style.width = '100%';
        overlay.style.height = '100%';
        overlay.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';
        overlay.style.backdropFilter = 'blur(5px)';
        overlay.style.zIndex = '9998';

        // Agregar el fondo al documento
        document.body.appendChild(overlay);

        // Mostrar el spinner y hacerlo girar
        spinner.style.display = 'block';
        if(spinSpeed>100) {
            spinSpeed = 100;
        }
        spinSpeed = spinSpeed / 10;
        console.log(spinSpeed)
        spinner.style.animation = 'spin '+(spinSpeed)+'s linear infinite';
    } else {
        console.error(`No se encontró el spinner con el ID "${spinnerId}".`);
    }
}

/**
 * Cierra un spinner existente
 * @param {string} spinnerId - El ID del spinner a cerrar
 */
function closeSpinner(spinnerId) {
    // Obtener el spinner por su ID
    const spinner = document.getElementById(spinnerId);

    if (spinner) {
        // Ocultar el spinner
        spinner.style.display = 'none';
        spinner.style.animation = 'none';

        // Obtener todos los overlays
        const overlays = document.querySelectorAll('.spinner-overlay');

        // Verificar cuántos spinners están abiertos
        const openSpinners = document.querySelectorAll('.spinner').length;

        // Si solo hay un spinner abierto, eliminar el overlay
        if (openSpinners === 1) {
            overlays.forEach(overlay => overlay.remove());
        } else {
            // Si hay más de un spinner abierto, eliminar solo el overlay correspondiente
            const overlay = document.querySelector(`.spinner-overlay`);
            if (overlay) {
                overlay.remove();
            }
        }
    } else {
        console.error(`No se encontró el spinner con el ID "${spinnerId}".`);
    }
}

/**
 * Destruye un spinner existente
 * @param {string} spinnerId - El ID del spinner a destruir
 */
function destroySpinner(spinnerId) {
    // Obtener el spinner por su ID
    const spinner = document.getElementById(spinnerId);

    if (spinner) {
        // Ocultar el spinner
        spinner.style.display = 'none';

        // Esperar 300ms para asegurarse de que el spinner está oculto
        setTimeout(() => {
            // Eliminar el spinner del DOM
            spinner.remove();

            // Obtener todos los overlays
            const overlays = document.querySelectorAll('.spinner-overlay');

            // Verificar cuántos spinners están abiertos
            const openSpinners = document.querySelectorAll('.spinner').length;

            // Si solo hay un spinner abierto, eliminar el overlay
            if (openSpinners === 0) {
                overlays.forEach(overlay => overlay.remove());
            } else {
                // Si hay más de un spinner abierto, eliminar solo el overlay correspondiente
                const overlay = document.querySelector(`.spinner-overlay`);
                if (overlay) {
                    overlay.remove();
                }
            }
        }, 300);
    } else {
        console.error(`No se encontró el spinner con el ID "${spinnerId}".`);
    }
}





  </script>
</body>
</html>